<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>deck.gl GPU Histogram</title>
  <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    #container {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>

<body>
  <div id="container"></div>
  <script type="module">
    import { Deck, OrthographicView, OrthographicController, GPUGridLayer } from "https://unpkg.com/deck.gl@latest/dist.min.js";

    // Simulate Futhark output: values from cosine or random distribution
    const N = 2 ** 20; // 1 million points
    const data = Array.from({ length: N }, (_, i) => ({
      x: Math.cos(i / 1000) + Math.random() * 0.2,
      y: 0, // constant y for 1D-like display
    }));

    // GPU aggregation by X coordinate
    const layer = new GPUGridLayer({
      id: 'gpu-hist',
      data,
      getPosition: d => [d.x * 100, d.y], // scale for better view
      cellSizePixels: 5, // bin width
      colorRange: [
        [0, 0, 0, 0],
        [0, 0, 255, 100],
        [0, 255, 0, 150],
        [255, 255, 0, 200],
        [255, 0, 0, 255],
      ],
      getColorWeight: () => 1, // each point adds weight 1
      gpuAggregation: true, // enable GPU histogram
      aggregation: 'SUM',
    });

    new Deck({
      parent: document.getElementById('container'),
      initialViewState: {
        target: [0, 0, 0],
        zoom: 3,
      },
      controller: OrthographicController,
      views: new OrthographicView(),
      layers: [layer],
    });
  </script>
</body>

</html>